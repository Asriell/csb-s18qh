<!DOCTYPE html><head><meta charset="utf-8"><script src="https://d3js.org/d3.v7.min.js"></script><style>body{margin:0;position:fixed;top:0;right:0;bottom:0;left:0}.departement:hover{fill:#666}.hidden{display:none}div.tooltip{color:#222;background-color:#fff;padding:.5em;text-shadow:#f5f5f5 0 1px 0;border-radius:2px;opacity:.9;position:absolute}</style></head><body> <div> <input id="slider" type="range" value="0" min="0" max="178" step="1"><br> <span id="day">day</span> </div> <script>var e=700,t=580,a=d3.select("body").append("svg").attr("width",e).attr("height",t),n=a.append("g"),r=d3.select("body").append("div").attr("class","hidden tooltip"),o=d3.geoConicConformal().center([2.454071,46.279229]).scale(2800),s=d3.geoPath().projection(o),l="2021-09-12",i=d3.scaleQuantize().range(["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"]);d3.csv("covid-06-11-2021.csv").then(function(e){var t=e.filter(function(e){return 0==e.sexe});i.domain([d3.min(t,function(e){return e.hosp}),d3.max(t,function(e){return e.hosp})]),d3.json("departements.geojson").then(function(e){for(var a=0;a<e.features.length;a++){var n=e.features[a].properties.code,r=t.filter(function(e){return n==e.dep});console.log(r),e.features[a].properties.value=r}var o=new Date(r[0].jour);d3.select("#day").html(("0"+o.getDate()).slice(-2)+"/"+("0"+(o.getMonth()+1)).slice(-2)+"/"+o.getFullYear()),c(e,0),d3.select("#slider").on("input",function(){this.value=+this.value<e.features[0].properties.value.length?+this.value:e.features[0].properties.value.length-1,o=new Date(r[+this.value].jour),d3.select("#day").html(("0"+o.getDate()).slice(-2)+"/"+("0"+(o.getMonth()+1)).slice(-2)+"/"+o.getFullYear()),c(e,+this.value)})})});var c=function(e,t){a.selectAll("path").data(e.features).join("path").attr("class","departement").attr("d",s).style("fill",function(e){var a=e.properties.value[t].hosp;return a?i(a):"#ccc"}).on("mousemove",function(e,a){var n=[e.x,e.y];r.classed("hidden",!1).attr("style","left:"+(n[0]+15)+"px; top:"+(n[1]-35)+"px").html(a.properties.nom+"  ("+a.properties.code+")  : "+a.properties.value[t].hosp)}).on("mouseout",function(){r.classed("hidden",!0)})};</script> </body>